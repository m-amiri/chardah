version: '3.8'

services:
  # Flask application
  app:
    build:
      context: .
      dockerfile: Dockerfile
      target: production
    container_name: chardah-app
    ports:
      - "5014:5014"
    environment:
      - FLASK_ENV=production
      - MAX_WORKERS=${MAX_WORKERS:-4}
      - LOG_LEVEL=${LOG_LEVEL:-INFO}
      - RAPIDAPI_KEY=${RAPIDAPI_KEY:-79ed527d4dmsh4cb995852b24aaep1a7e21jsn6249410b641b}
      - RAPIDAPI_HOST=${RAPIDAPI_HOST:-fresh-linkedin-profile-data.p.rapidapi.com}
      # External model service URL - configure this to point to your external host
      - MODEL_API_URL=${MODEL_API_URL:-http://host.docker.internal:8000/score}
    # Use host network mode to access external services, or remove networks entirely
    network_mode: bridge
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "python", "-c", "import requests; requests.get('http://localhost:5014/health')"]
      interval: 30s
      timeout: 5s
      retries: 3
      start_period: 10s
